<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin-top: 80px;
      }
      input {
        width: 60%;
        padding: 10px;
        font-size: 16px;
      }
      button {
        margin-top: 10px;
        padding: 10px 20px;
        font-size: 18px;
      }
      #response {
        margin-top: 20px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h2>Meal Voucher Redemption</h2>
    <div id="operatorDisplay"></div>
    <br>
    <input type="text" id="voucherInput" placeholder="Enter or scan voucher code" autofocus />
    <br>
    <button onclick="validateVoucher()">Validate Voucher</button>
    <div id="response"></div>

    <script>
      const endpoint = "https://script.google.com/macros/s/AKfycbzoiMeh_L-sI7bhdg05R8Yf7jMQVKVhcv2Ntux5dlxaeOB--1VEdS0WHLtU2kTaqjDxKA/exec";
      let operator = "";

      window.onload = function () {
        operator = sessionStorage.getItem("operatorName") || prompt("Enter your name (First Last):") || "Unknown";
        sessionStorage.setItem("operatorName", operator);
        document.getElementById("operatorDisplay").innerText = "Logged in as: " + operator;
      };

      function validateVoucher() {
        const voucher = document.getElementById("voucherInput").value.trim();
        if (!voucher) return;

        const responseBox = document.getElementById("response");
        responseBox.innerHTML = "Validatingâ€¦";
        responseBox.style.color = "black";

        fetch(endpoint, {
          method: "POST",
          body: JSON.stringify({
            voucherKey: voucher,
            operator: operator,
            source: "web"
          }),
          headers: { "Content-Type": "application/json" }
        })
          .then(res => res.json())
          .then(data => {
            if (data.result === "Redeemed") {
              responseBox.innerHTML = "Voucher Redeemed";
              responseBox.style.color = "green";
            } else if (data.result === "Already Redeemed") {
              responseBox.innerHTML = "Already Redeemed";
              responseBox.style.color = "orange";
            } else if (data.result === "ERROR") {
              responseBox.innerHTML = "ERROR: " + (data.message || "Unknown issue");
              responseBox.style.color = "red";
            } else {
              responseBox.innerHTML = "Invalid Voucher";
              responseBox.style.color = "gray";
            }

            document.getElementById("voucherInput").value = "";
            document.getElementById("voucherInput").focus();
          })
          .catch(error => {
            responseBox.innerHTML = "Fetch ERROR: " + error.message;
            responseBox.style.color = "red";
          });
      }
    </script>
  </body>
</html>
